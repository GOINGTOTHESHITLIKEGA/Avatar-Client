<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Avatar Launcher</title>
<style>
  body { font-family: Arial, sans-serif; background: #1e1e2f; color: #fff; margin: 0; padding: 20px; }
  h1 { text-align: center; }
  #versions-grid { display: flex; flex-wrap: wrap; gap: 10px; margin: 20px 0; }
  .ver-btn { padding: 10px 15px; background: #2c2c44; cursor: pointer; border-radius: 6px; transition: 0.2s; }
  .ver-btn:hover { background: #3a3a5a; }
  .ver-btn.selected { background: #ff6f61; }
  .tiny.muted { font-size: 0.7em; color: #aaa; margin-left: 5px; }
  #launch-btn { display: block; margin: 20px auto; padding: 10px 20px; font-size: 1.2em; cursor: pointer; border-radius: 6px; background: #4caf50; border: none; transition: 0.2s; }
  #launch-btn:hover { background: #45a049; }
  #version-error { color: #f55; text-align: center; display: none; margin-top: 10px; }
  #loading { display: none; text-align: center; margin-top: 10px; }
</style>
</head>
<body>

<h1>Avatar Launcher</h1>

<div id="versions-grid">
  <!-- Version buttons will appear here -->
</div>

<button id="launch-btn">Launch</button>
<div id="version-error">Please select a version!</div>
<div id="loading">Loading...</div>

<script>
  const versionsGrid = document.getElementById('versions-grid');
  const versionsLaunchBtn = document.getElementById('launch-btn');
  const versionError = document.getElementById('version-error');
  const loading = document.getElementById('loading');

  let selectedVersionBtn = null;

  function playClick() { /* placeholder click sound */ console.log('Click'); }
  function showLoading(){ loading.style.display = 'block'; }
  function hideLoading(){ loading.style.display = 'none'; }
  function escapeHtml(text) { return text.replace(/[&<>"']/g, t => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[t])); }

  /* --------------------------
     Installed Versions Handling
     -------------------------- */
  const INSTALLED_KEY = 'installed_versions';
  let installedVersions = JSON.parse(localStorage.getItem(INSTALLED_KEY) || '[]');

  function renderInstalledVersions() {
    versionsGrid.innerHTML = ''; // clear existing
    installedVersions.forEach(v => {
      const div = document.createElement('div');
      div.className = 'ver-btn';
      div.dataset.url = v.url;
      div.innerHTML = `${escapeHtml(v.name)} <span class="tiny muted">Installed</span>`;
      versionsGrid.appendChild(div);
    });
    // Optional: add some default online versions
    const defaultVersions = [
      {name: '1.20', url: 'https://example.com/1.20'},
      {name: '1.21', url: 'https://example.com/1.21'}
    ];
    defaultVersions.forEach(v => {
      const div = document.createElement('div');
      div.className = 'ver-btn';
      div.dataset.url = v.url;
      div.textContent = v.name;
      versionsGrid.appendChild(div);
    });
  }
  renderInstalledVersions();

  /* Add new installed version (demo) */
  function addInstalledVersion(name, url){
    installedVersions.push({name, url});
    localStorage.setItem(INSTALLED_KEY, JSON.stringify(installedVersions));
    renderInstalledVersions();
  }

  /* --------------------------
     Version Selection
     -------------------------- */
  versionsGrid.addEventListener('click', (e)=>{
    let el = e.target;
    while(el && !el.classList.contains('ver-btn')) el = el.parentElement;
    if(!el) return;
    if(selectedVersionBtn) selectedVersionBtn.classList.remove('selected');
    selectedVersionBtn = el;
    el.classList.add('selected');
    versionError.style.display = 'none';
    playClick();
  });

  /* --------------------------
     Launch Button
     -------------------------- */
  versionsLaunchBtn.addEventListener('click', ()=>{
    if(!selectedVersionBtn){ versionError.style.display = 'block'; playClick(); return; }
    const url = selectedVersionBtn.dataset.url;
    if(!url) return;
    showLoading();
    setTimeout(()=>{
      hideLoading();
      window.open(url, '_blank');
    }, 1200);
    playClick();
  });

  // Demo: add a new installed version (uncomment to test)
  // addInstalledVersion('1.18', 'https://example.com/1.18');

</script>

</body>
</html>
